<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no"/>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <title>Mosaikmissionen München</title>
    <link rel="stylesheet" href="css/foundation.css"/>
    <link rel="stylesheet" href="css/ownStyle.css"/>
    

    <script src="js/vendor/modernizr.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.css' rel='stylesheet'/>
    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-label/v0.2.1/leaflet.label.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-label/v0.2.1/leaflet.label.css' rel='stylesheet'/>
    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.43.0/L.Control.Locate.min.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.43.0/L.Control.Locate.mapbox.css'
          rel='stylesheet'/>
    <!--[if lt IE 9]>
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.43.0/L.Control.Locate.ie.css'
          rel='stylesheet'/>
    <![endif]-->
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.43.0/css/font-awesome.min.css'
          rel='stylesheet'/>

    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css' rel='stylesheet' />
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css' rel='stylesheet' />
	<script src="js/vendor/jquery.js"></script>
	<script src="js/helpFunctions.js"></script>
	<script type="text/javascript" src="missions.js"></script>
	

</head>
<body>
<div class="fixed">
    <nav class="top-bar" data-topbar role="navigation">
        <ul class="title-area">
            <li class="name">
                <h1><a href="index.html" id="title">Mosaikkarte München</a></h1>
            </li>
            <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
            <li class="toggle-topbar menu-icon active"><a href="#" style="color: #ff8000;"><span>Menü</span></a></li>
        </ul>

        <section class="top-bar-section">
            <ul class="left">
                <li class="has-dropdown">
                    <a href="#" style="color: #ff8000;">Mosaikliste</a>
                    <ul class="dropdown">
                        <li class="has-dropdown"><a href="#">60er Mosaik</a>
                            <ul class="dropdown">
                                <li><a href="index.html?id=28">Olympiaturm München</a></li>
                            </ul>
                        </li>
                        <li class="has-dropdown"><a href="#">36er Mosaik</a>
                            <ul class="dropdown">
                                <li><a href="index.html?id=38">Celtic Knot</a></li>
                            </ul>
                        </li>
                        <li class="has-dropdown"><a href="#">24er Mosaike</a>
                            <ul class="dropdown">
                                <li><a href="index.html?id=42">Antiquarium München</a></li>
                                <li><a href="index.html?id=16">Districts of Munich</a></li>
                                <li><a href="index.html?id=23">Das große Biergartenmosaik</a></li>
								<li><a href="index.html?id=46">Endless I</a></li>
                                <li><a href="index.html?id=31">Karlsplatz, Stachus</a></li>
                                <li><a href="index.html?id=4">Marienplatz</a></li>
                                <li><a href="index.html?id=2">Münchner Kindl</a></li>
                                <li><a href="index.html?id=12">Munich City</a></li>
                                <li><a href="index.html?id=10">Munich Portal Hunter Stroll</a></li>
                                <li><a href="index.html?id=26">Pasinger Stadtwappen</a></li>
                                <li><a href="index.html?id=20">Resistance München</a></li>
                                <li><a href="index.html?id=43">Schleissheim Postcard</a></li>
								<li><a href="index.html?id=49">1972 Summer Olympics</a></li>
                                <li><a href="index.html?id=30">Stadtwappen Dachau</a></li>
                                <li><a href="index.html?id=32">X-MAS Mosaik</a></li>
                            </ul>
                        </li>
                        <li class="has-dropdown"><a href="#">18er Mosaike</a>
                            <ul class="dropdown">
                                <li><a href="index.html?id=39">Dachau goes Warcraft</a></li>
								<li><a href="index.html?id=47">Endless II</a></li>
                                <li><a href="index.html?id=34">FFB Enl-Mosaik</a></li>
                                <li><a href="index.html?id=21">Germeringer Kermit</a></li>
                                <li><a href="index.html?id=9">Ismaning Mosaik</a></li>
                                <li><a href="index.html?id=1">München Panorama</a></li>
                                <li><a href="index.html?id=33">The Shapers Eye</a></li>
                            </ul>
                        </li>
                        <li class="has-dropdown"><a href="#">12er Mosaike</a>
                            <ul class="dropdown">
								<li><a href="index.html?id=48">Endless III</a></li>
                                <li><a href="index.html?id=19">Spaziergang durch Erding</a></li>
                                <li><a href="index.html?id=11">Spiderweb</a></li>
                                <li><a href="index.html?id=13">Sunset at the Lake</a></li>
                            </ul>
                        </li>
                        <li class="has-dropdown"><a href="#">6er Mosaike</a>
                            <ul class="dropdown">
                                <li><a href="index.html?id=36">AURUM Dachau</a></li>
                                <li><a href="index.html?id=37">ARGENTUM Dachau</a></li>
                                <li><a href="index.html?id=15">Äußerer Radring</a></li>
                                <li><a href="index.html?id=41">EXPUGNA SENTILINGA</a></li>
                                <li><a href="index.html?id=22">Germering</a></li>
                                <li><a href="index.html?id=14">Innerer Radring</a></li>
								<li><a href="index.html?id=45">Oberhachinger Runde</a></li>
                                <li><a href="index.html?id=27">Pullach im Isartal</a></li>
                                <li><a href="index.html?id=25">Westkreuz</a></li>
                            </ul>
                        </li>
                        <li class="has-dropdown"><a href="#">5er Mosaik</a>
                            <ul class="dropdown">
                                <li><a href="index.html?id=35">Türkenfeld</a></li>
                            </ul>
                        </li>
                        <li class="has-dropdown"><a href="#">4er Mosaike</a>
                            <ul class="dropdown">
                                <li><a href="index.html?id=17">Englischer Garten</a></li>
                                <li><a href="index.html?id=8">I love München</a></li>
                                <li><a href="index.html?id=29">Münchens Biergärten</a></li>
                                <li><a href="index.html?id=18">Trudering</a></li>
                            </ul>
                        </li>
                        <li class="has-dropdown"><a href="#">3er Mosaike</a>
                            <ul class="dropdown">
                                <li><a href="index.html?id=5">Hachinger Bach</a></li>
                                <li><a href="index.html?id=24">Schloss Nymphenburg</a></li>
								<li><a href="index.html?id=44">Schlösser in Oberschleißheim</a></li>
                            </ul>
                        </li>
						<!-- previously used for the special starwars missions
                        <li class="has-dropdown"><a href="#">Spezialmissionen</a>
                            <ul class="dropdown">
                                <li></li>
                            </ul>
                        </li> -->
                    </ul>
                </li>
                <li><a href="info.html">Legende</a></li>
                <li><a href="overview.html">Übersicht</a></li>
                <li><a href="contact.html">Kontakt</a></li>
            </ul>
        </section>
    </nav>
</div>
<div id="map"></div>
<script>
var totalPortals = 0;
var uniquePortals = 0;
var authorName = null;
var actionCount = 0;
var countPortalsInMission = 0;
var countFieldtripsInMission = 0;
var countActionHack = 0;
var countActionCapture = 0;
var countActionLink = 0;
var countActionField = 0;
var countActionMod = 0;
var countActionPhoto = 0;
var countActionViewWaypoint = 0;
var countActionPassphrase = 0;
var missionLength = 0;
var asOf;
var medianCompletionTime = 0;

// initialize background map
L.mapbox.accessToken = '<PUT YOUR API-KEY HERE>';
var southWest = L.latLng(47.653085, 10.754076);
var northEast = L.latLng(48.756453, 12.649536);
bounds = L.latLngBounds(southWest, northEast);
var map = L.mapbox.map('map', 'mapbox.streets', {
		maxBounds : bounds,
		maxZoom : 17,
		minZoom : 10
	})
map.setView([48.14, 11.57], 14);	
L.control.locate().addTo(map);

// create ClusterGroup for start points on the main map
var markers = new L.MarkerClusterGroup({
        spiderfyOnMaxZoom: true,
        showCoverageOnHover: false,
        zoomToBoundsOnClick: true,
        maxClusterRadius: 20,
        spiderfyDistanceMultiplier: 2
    });

// shows all start portals of every single mosaic, when no specific one is choosen
function showStartPortals() {
	 markers.addLayer(L.geoJson(panorama_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(kindl_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(marienplatz_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(bach_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(love_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(ismaning_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(stroll_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(spiderweb_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(city_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(sunset_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(innen_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(aussen_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(districts_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(garten_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(trudering_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(erding_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(res_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(kermit_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(germering_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(biergarten_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	markers.addLayer(L.geoJson(nymphenburg_startMissions.features[0], {pointToLayer : startMissionStyle, onEachFeature : onEachPointOverview}));
	 markers.addLayer(L.geoJson(westkreuz_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(pasing_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(pullach_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	markers.addLayer(L.geoJson(olyturm_startMissions.features[0], {pointToLayer : startMissionStyle, onEachFeature : onEachPointOverview}));
	 markers.addLayer(L.geoJson(bier_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(dachau_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	markers.addLayer(L.geoJson(stachus_startMissions.features[0], {pointToLayer : startMissionStyle, onEachFeature : onEachPointOverview}));
	 markers.addLayer(L.geoJson(xmas_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(shapers_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(ffbenl_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(turk_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(aurum_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(argentum_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(celtic_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(warcraft_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	markers.addLayer(L.geoJson(sendling_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(antiquar_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	 markers.addLayer(L.geoJson(postcard_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	markers.addLayer(L.geoJson(oberhaching_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	markers.addLayer(L.geoJson(schleiss_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	markers.addLayer(L.geoJson(endlessI_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	markers.addLayer(L.geoJson(endlessII_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	markers.addLayer(L.geoJson(endlessIII_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	markers.addLayer(L.geoJson(olympics_startMissions.features[0], {pointToLayer: startMissionStyle, onEachFeature: onEachPointOverview}));
	
	map.addLayer(markers);
}
switch (getQueryVariable("id")) {
case "1":
	addLayer(panorama_mission, panorama_startMissions);
	break;
case "2":
	addLayer(kindl_mission, kindl_startMissions);
	break;
// case 3 was: Weihnachtliches München
case "4":
	addLayer(marienplatz_mission, marienplatz_startMissions);
	break;
case "5":
	addLayer(bach_mission, bach_startMissions);
	break;
// case 6 was: Hacken in Giesing
case "7":
	addLayer(endless_mission, endless_startMissions);
	break;
case "8":
	addLayer(love_mission, love_startMissions);
	break;
case "9":
	addLayer(ismaning_mission, ismaning_startMissions);
	break;
case "10":
	addLayer(stroll_mission, stroll_startMissions);
	break;
case "11":
	addLayer(spiderweb_mission, spiderweb_startMissions);
	break;
case "12":
	addLayer(city_mission, city_startMissions);
	break;
case "13":
	addLayer(sunset_mission, sunset_startMissions);
	break;
case "14":
	addLayer(innen_mission, innen_startMissions);
	break;
case "15":
	addLayer(aussen_mission, aussen_startMissions);
	break;
case "16":
	addLayer(districts_mission, districts_startMissions);
	break;
case "17":
	addLayer(garten_mission, garten_startMissions);
	break;
case "18":
	addLayer(trudering_mission, trudering_startMissions);
	break;
case "19":
	addLayer(erding_mission, erding_startMissions);
	break;
case "20":
	addLayer(res_mission, res_startMissions);
	break;
case "21":
	addLayer(kermit_mission, kermit_startMissions);
	break;
case "22":
	addLayer(germering_mission, germering_startMissions);
	break;
case "23":
	addLayer(biergarten_mission, biergarten_startMissions);
	break;
case "24":
	addLayer(nymphenburg_mission, nymphenburg_startMissions);
	break;
case "25":
	addLayer(westkreuz_mission, westkreuz_startMissions);
	break;
case "26":
	addLayer(pasing_mission, pasing_startMissions);
	break;
case "27":
	addLayer(pullach_mission, pullach_startMissions);
	break;
case "28":
	addLayer(olyturm_mission, olyturm_startMissions);
	break;
case "29":
	addLayer(bier_mission, bier_startMissions);
	break;
case "30":
	addLayer(dachau_mission, dachau_startMissions);
	break;
case "31":
	addLayer(stachus_mission, stachus_startMissions);
	break;
case "32":
	addLayer(xmas_mission, xmas_startMissions);
	break;
case "33":
	addLayer(shapers_mission, shapers_startMissions);
	break;
case "34":
	addLayer(ffbenl_mission, ffbenl_startMissions);
	break;
case "35":
	addLayer(turk_mission, turk_startMissions);
	break;
case "36":
	addLayer(aurum_mission, aurum_startMissions);
	break;
case "37":
	addLayer(argentum_mission, argentum_startMissions);
	break;
case "38":
	addLayer(celtic_mission, celtic_startMissions);
	break;
case "39":
	addLayer(warcraft_mission, warcraft_startMissions);
	break;
case "40":
	addLayer(star_mission, star_startMissions);
	break;
case "41":
	addLayer(sendling_mission, sendling_startMissions);
	break;
case "42":
	addLayer(antiquar_mission, antiquar_startMissions);
	break;
case "43":
	addLayer(postcard_mission, postcard_startMissions);
	break;
case "44":
	addLayer(schleiss_mission, schleiss_startMissions);
	break;
case "45":
	addLayer(oberhaching_mission, oberhaching_startMissions);
	break;
case "46":
	addLayer(endlessI_mission, endlessI_startMissions);
	break;
case "47":
	addLayer(endlessII_mission, endlessII_startMissions);
	break;
case "48":
	addLayer(endlessIII_mission, endlessIII_startMissions);
	break;
case "49":
	addLayer(olympics_mission, olympics_startMissions);
	break;
default:
	showStartPortals();
	break;
}
function addLayer(feature, startMissions) {
	document.getElementById("title").innerHTML = "◄ " + startMissions.features[0].properties.title;
	var arrayPortals = [];
	var arrayPortalTypeNum = [];
	var arrayPortalObjectiveNum = [];

	for (var i = feature.features.length - 1; i >= 0; i--) {
		// collect all waypoints of the mosaic
		for (var j = feature.features[i].geometry.coordinates.length - 1; j >= 0; j--) {
			arrayPortals.push(feature.features[i].geometry.coordinates[j]);
		}
		// collect all type of every waypoint of the mosaic
		arrayPortalTypeNum.push(feature.features[i].properties.portalTypeNum);
		// collect all objectives (actions) of every waypoint of the mosaic
		arrayPortalObjectiveNum.push(feature.features[i].properties.portalObjectiveNum);
		// count total completion time of the mosaic
		medianCompletionTime += feature.features[i].properties.medianCompletionTimeMs;
	}

	// calc mission length incl. gaps between the missions itself
	var tempLength = 0;
	for (var i = 0; i < arrayPortals.length - 1; i++) {
		tempLength += calcDistance(arrayPortals[i], arrayPortals[i + 1]);
	}
	missionLength = tempLength;

	countPortalsInMission = $.grep(arrayToOneDimension(arrayPortalTypeNum), function (elem) {
			return elem === 1; // value for Portal
		}).length;
	countFieldtripsInMission = $.grep(arrayToOneDimension(arrayPortalTypeNum), function (elem) {
			return elem === 2; // value for Fieldtrip Waypoint
		}).length;

	countActionHack = $.grep(arrayToOneDimension(arrayPortalObjectiveNum), function (elem) {
			return elem === 1; // value for Action Hack
		}).length;
	countActionCapture = $.grep(arrayToOneDimension(arrayPortalObjectiveNum), function (elem) {
			return elem === 2; // value for Action Capture or Upgrade
		}).length;
	countActionLink = $.grep(arrayToOneDimension(arrayPortalObjectiveNum), function (elem) {
			return elem === 3; // value for Action Create Link from Portal
		}).length;
	countActionField = $.grep(arrayToOneDimension(arrayPortalObjectiveNum), function (elem) {
			return elem === 4; // value for Action Create Field from Portal
		}).length;
	countActionMod = $.grep(arrayToOneDimension(arrayPortalObjectiveNum), function (elem) {
			return elem === 5; // value for Action Install Mod on Portal
		}).length;
	countActionPhoto = $.grep(arrayToOneDimension(arrayPortalObjectiveNum), function (elem) {
			return elem === 6; // value for Action Take a Photo
		}).length;
	countActionViewWaypoint = $.grep(arrayToOneDimension(arrayPortalObjectiveNum), function (elem) {
			return elem === 7; // value for Action View this Fieldtrip Waypoint
		}).length;
	countActionPassphrase = $.grep(arrayToOneDimension(arrayPortalObjectiveNum), function (elem) {
			return elem === 8; // value for Action Enter the Passphrase
		}).length;

	asOf = new Date(feature.features[0].properties.time);

	authorName = feature.features[0].properties.author;
	totalPortals = arrayPortals.length;
	uniquePortals = unique(arrayPortals).length;

	var missionLayer = L.geoJson(feature, {
			style : missionStyles,
			onEachFeature : onEachFeature
		});
	var startSingleMissions = L.geoJson(startMissions, {
			pointToLayer : startMissionStyle,
			onEachFeature : onEachStartPoint
		});

	map.addLayer(missionLayer);
	map.addLayer(startSingleMissions);
	//set mapView to the start of the mosaic
	map.setView([startMissions.features[0].geometry.coordinates[1], startMissions.features[0].geometry.coordinates[0]], 16);
}


	function onEachFeature(feature, layer) {
		var popupContent = "";
		if (feature.properties && feature.properties.title && feature.properties.typeNumMission) {
			popupContent +=  feature.properties.title/*+ '</br>Dauer: ca. '+ calcTime(feature.properties.medianCompletionTimeMs)*/;
		}

		layer.bindLabel(popupContent);

		layer.on("mouseover", function (e) {
			layer.setStyle({
				"weight" : 8
			})
		});
		layer.on("mouseout", function (e) {
			layer.setStyle({
				"weight" : 4
			})
		});
		layer.on("click", function (e) {
			layer.setStyle({
				"weight" : 8
			})
		});
	}

	

function missionStyles(feature) {
	if (feature.properties && feature.properties.typeNumMission) {
		switch (feature.properties.typeNumMission) {
		case 2: //non sequential
			return {
				"color" : '#ff8000',
				"dashArray" : "5,8",
				"smoothFactor" : 1,
				"lineJoin" : "round",
				"opacity" : 1,
				"weight" : 4
			};
		case 1: //sequential
			return {
				"color" : '#ff8000',
				"smoothFactor" : 1,
				"lineJoin" : "round",
				"opacity" : 1,
				"weight" : 4
			};
		}
	}
}

// what is shown on the overview at the map
function onEachPointOverview(feature, layer) {
	if (feature.properties && feature.properties.title) {
		layer.bindPopup(
			'<h4>' + feature.properties.title + '</h4>'
			 + '<img class="mapPic" src="' + feature.properties.imagePath + '">'
			 + '<p><a href="index.html?id=' + feature.properties.id + '">Details/Route in der Karte anzeigen</a></p>');
	}
}

function onEachStartPoint(feature, layer) {
	if (feature.properties && feature.properties.missionNumber) {
		// create clickable intel-link for every mission start as label
		layer.bindLabel('<a id="linkPortal" title="Startportal in Intel aufrufen" href="https://www.ingress.com/intel?' + feature.geometry.coordinates[1] + ',' + feature.geometry.coordinates[0] + '&z=17&pll=' + feature.geometry.coordinates[1] + ',' + feature.geometry.coordinates[0] + '">' + feature.properties.missionNumber.toString() + '</a>', {
			noHide : true
		});
		// add a popup with information on the start point of the first mission
		switch (feature.properties.missionNumber) {
		case "1-12": // special pattern solely for the spiderweb-mosaic
		case "1, 7": // special pattern solely for the sunset-mosaic
		case "1, 3": // special pattern solely for the germering-mosaic
		case 1:
			if (feature.properties && feature.properties.title) {
				// concat action string
				var actionsString = []
				if (countActionHack > 0) {
					actionsString.push(countActionHack + ' x Hack')
				}
				if (countActionCapture > 0) {
					actionsString.push(countActionCapture + ' x Capture oder Upgrade')
				}
				if (countActionLink > 0) {
					actionsString.push(countActionLink + ' x Link erstellen')
				}
				if (countActionField > 0) {
					actionsString.push(countActionField + ' x Feld erstellen')
				}
				if (countActionMod > 0) {
					actionsString.push(countActionMod + ' x Mod deployen')
				}
				if (countActionPhoto > 0) {
					actionsString.push(countActionPhoto + ' x Photo machen')
				}
				if (countActionViewWaypoint > 0) {
					actionsString.push(countActionViewWaypoint + ' x Fieldtrip Waypoint')
				}
				if (countActionPassphrase > 0) {
					actionsString.push(countActionPassphrase + ' x Passphrase eingeben')
				}
				// create output mission length
				var outputMissionLength = ""
					if (missionLength < 1) {
						//when length < 1km display the value in meters
						outputMissionLength += (missionLength * 1000).toFixed(0) + ' m'
					} else {
						// when length > 1km display the value in kilometers
						outputMissionLength += missionLength.toFixed(2) + ' km'
					}
				
					var popupContent =
					'<h4>' + feature.properties.title + '</h4>'

					 + '<p><span>Ersteller: </span>' + authorName + '</p>'
					 + '<p><span>Zeit: </span>ca. ' + calcTime(medianCompletionTime) + '</p>'
					 + '<p><span>Länge: </span>ca. ' + outputMissionLength + '</p>'
					 + '<p><span>Aktionen: </span>' + actionsString.join(", ") + '</p>'
					 + '<p><span>Gesamtanzahl Portale: </span>' + totalPortals + '</p>'
					 + '<p><span>Anzahl Unique Portale: </span>' + uniquePortals + '</p>'
					 + '<p><span>Mehr: </span>' + feature.properties.description + '</p>'
					 + '<p><span>Download: </span><a href="'+feature.properties.imagePath.replace('pics','kml').replace('.jpg','.kml')+'">Download als kml</a>' +'</p>'
					if (feature.properties.info != "---") {
						popupContent += '<p><span>G+: </span><a href="' + feature.properties.info + '">mehr Infos auf G+</a></p>'
					} else {
						popupContent += '<p><span>G+: </span>Leider kein G+ Post verfügbar</p>'
					}
					popupContent += '<img class="mapPic" src="' + feature.properties.imagePath + '">'
					 + '<p><span>Stand vom: </span>' + asOf.getDate() + '.' + (asOf.getMonth()) + 1 + '.' + asOf.getFullYear() + '</p>'

					layer.bindPopup(popupContent);
			}
			break;
		}
	}
}


function startMissionStyle(feature, latlng) {
	switch (feature.properties.missionNumber) {
	case "1-12": // special pattern solely for the spiderweb-mosaic
	case "1, 7": // special pattern solely for the sunset-mosaic
	case "1, 3": // special pattern solely for the germering-mosaic
	case 1:
		return L.circleMarker(latlng, {
			radius : 8,
			fillColor : '#ff8000',
			color : '#fff',
			weight : 2,
			opacity : 1,
			fillOpacity : 1
		})
		break;
	default:
		return L.circleMarker(latlng, {
			radius : 5,
			color : '#bbb',
			fillOpacity : 0,
			opacity : 1
		})
		break;
	}
}
// return the get value of id
function getQueryVariable(variable) {
	var query = window.location.search.substring(1);
	var vars = query.split("&");
	for (var i = 0; i < vars.length; i++) {
		var pair = vars[i].split("=");
		if (pair[0] == variable) {
			return pair[1];
		}
	}
	return (false);
}

</script>

<script src="js/foundation.min.js"></script>
<script>
    $(document).foundation({
        topbar: {
            custom_back_text: true,
            back_text: 'Zurück'
        }
    });

</script>
</body>
</html>
